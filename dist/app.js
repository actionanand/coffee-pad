(function(){var t,e,n,r,o,i,s,c,l,a,u,d,f,m,h=function(t,e){for(var n in e)p.call(e,n)&&(t[n]=e[n]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},p={}.hasOwnProperty,g=[].slice;this.Models={},this.Controllers={},this.Views={},$((function(){return Controllers.DocumentController.init(),Controllers.CategoryController.init(),$("#sidebar a").on("click",(function(t){var e;return t.preventDefault(),e=$(t.currentTarget).attr("href"),f.call(e)}))})),t=function(){function t(){}return t.init=function(t,e){return this.model=t,this.views=e},t.list=function(){return(new this.views.list).render(this.model.all())},t.show=function(t){return(new this.views.item).render(this.model.read(t))},t.edit=function(t){return(new this.views.editor).render(this.model.read(t))},t.create=function(t){return(new this.views.editor).render(this.model.read())},t.update=function(t){return this.model.update(t),this.list()},t.store=function(t){return t.id=(new Date).getTime(),this.model.create(t),this.list()},t.delete=function(t){return this.model.delete(t),this.list()},t}(),Controllers.BaseController=t,r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return h(e,t),e.init=function(){return e.__super__.constructor.init.call(this,new Models.CategoryModel,{list:Views.CategoryListView}),d.on("category:update",(function(t){return e.update(t)})),d.on("category:store",(function(t){return e.store(t)}))},e}(Controllers.BaseController),Controllers.CategoryController=r,s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return h(e,t),e.init=function(){return e.__super__.constructor.init.call(this,new Models.DocumentModel,{list:Views.DocumentListView,item:Views.DocumentItemView,editor:Views.DocumentEditorView}),d.on("document:update",(function(t){return e.update(t)})),d.on("document:store",(function(t){return e.store(t)})),d.on("document:show",(function(t){return e.show(t)})),d.on("document:filter",(function(t){return e.list(t)})),e.list()},e.list=function(t){return t?(new this.views.list).render(this.model.getByCategory(t),t):e.__super__.constructor.list.call(this)},e}(Controllers.BaseController),Controllers.DocumentController=s,e=function(){function t(t){this.key=t,this.data=m.get(this.key)||{}}return t.prototype.all=function(){return this.data},t.prototype.create=function(t){return!this.data[t.id]&&(this.data[t.id]=t,this.persist(),!0)},t.prototype.read=function(t){return!!this.data[t]&&this.data[t]},t.prototype.update=function(t){return!!this.data[t.id]&&(this.data[t.id]=t,this.persist(),!0)},t.prototype.delete=function(t){return!!this.data[t]&&(this.data[t]=null,delete this.data[t],this.persist(),!0)},t.prototype.persist=function(){return m.set(this.key,this.data)},t}(),Models.BaseModel=e,i=function(t){function e(){e.__super__.constructor.call(this,"category")}return h(e,t),e}(Models.BaseModel),Models.CategoryModel=i,u=function(t){function e(){e.__super__.constructor.call(this,"document")}return h(e,t),e.prototype.getByCategory=function(t){var e,n;for(n in e={},this.data)this.data[n].category===t&&(e[n]=this.data[n]);return e},e}(Models.BaseModel),Models.DocumentModel=u,f=function(){function t(){}return t.routes={documents:Controllers.DocumentController.list,"document/show":Controllers.DocumentController.show,"document/edit":Controllers.DocumentController.edit,"document/new":Controllers.DocumentController.create,categories:Controllers.CategoryController.list},t.call=function(){var t,e;return e=arguments[0],t=2<=arguments.length?g.call(arguments,1):[],this.routes[e].call(this.context(e),t>0&&t)},t.context=function(t){return{document:Controllers.DocumentController,documents:Controllers.DocumentController,category:Controllers.CategoryController,categories:Controllers.CategoryController}[t.split("/")[0]]},t}(),this.Router=f,d=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return h(e,t),e}(Backbone.Events),this.EventEmitter=d,m=function(){function t(){}return t.get=function(t){return JSON.parse(localStorage.getItem(t))},t.set=function(t,e){return localStorage.setItem(t,JSON.stringify(e))},t}(),this.Storage=m,n=function(){function t(t,e){this.element=t,this.template=e}return t.prototype.render=function(t){return this.element.html(this.template(t))},t}(),Views.BaseView=n,o=function(t){function e(){e.__super__.constructor.call(this,$("#canvas"),(function(t){var e,n,r;for(e in r="<ul class='categories'>",t)r+="<li data-id='"+(n=t[e]).id+"'> <div class='title'>"+n.title+"</div> </li>";return r+"</ul>"}))}return h(e,t),e.prototype.render=function(t){return e.__super__.render.call(this,t),this.bind()},e.prototype.bind=function(){return this.element.find("li").on("click",(function(t){var e;return e=$(t.currentTarget).text(),d.trigger("document:filter",e.trim())}))},e}(Views.BaseView),Views.CategoryListView=o,c=function(t){function e(){var t;e.__super__.constructor.call(this,$("#canvas"),(t=this,function(e){var n,r;return null==e&&(e=!1),r="<label class='formitem'>title</label> <input class='formitem' type='text' name='title' /> <label class='formitem'>content</label> <div name='content'></div> <label class='formitem'>category</label> <select class='formitem' name='category'></select><button data-action='add-category'>+</button> <div class='actions'> <button class='formitem' data-action='save'>save</button> <button class='formitem' data-action='close'>cancel</button> </div>",(n=$("<div>")).html(r),n.find("[name='content']").summernote({height:400}),e?(n.find("input[name='title']").val(e.title),n.find("[name='content']").code(e.content),n.find("[name='category']").val(e.category),t.id=e.id,t.mode="update",r=n):t.mode="create",n}))}return h(e,t),e.prototype.render=function(t){var n,r;for(r in e.__super__.render.call(this,t),n=(new Models.CategoryModel).all(),console.log(n),n)console.log(n[r].title),$("select[name='category']").append("<option>"+n[r].title+"</option");return this.bind()},e.prototype.close=function(){return this.element.find("button").off("click"),f.call("documents")},e.prototype.bind=function(){return this.element.find("button").on("click",(t=this,function(e){var n,r,o;switch($(e.currentTarget).attr("data-action")){case"save":return n={title:t.element.find("input[name='title']").val(),content:t.element.find("[name='content']").code(),category:t.element.find("[name='category']").val()},"update"===t.mode?(n.id=t.id,d.trigger("document:update",n)):d.trigger("document:store",n),"add"===t.categoryMode&&d.trigger("category:store",{title:n.category}),t.close(),alert("Document saved");case"add-category":return r=$("select[name='category']"),o=$("<input name='category' />"),r.replaceWith(o),$("button[data-action='add-category']").remove(),t.categoryMode="add";case"close":return t.close()}}));var t},e}(Views.BaseView),Views.DocumentEditorView=c,l=function(t){function e(){e.__super__.constructor.call(this,$("#canvas"),(function(t){return"<article> <h1>"+t.title+"</h1> "+t.content+" </article> <div class='category'>"+t.category+"</div> <div class='actions'> <button class='formitem' data-action='edit' data-id='"+t.id+"'>Edit</button> <button class='formitem' data-action='export' data-id='"+t.id+"'>Export</button> <button class='formitem' data-action='delete' data-id='"+t.id+"'>Delete</button> <button class='formitem' data-action='close'>Close</button> </div>"}))}return h(e,t),e.prototype.render=function(t){return e.__super__.render.call(this,t),this.bind()},e.prototype.close=function(){return this.element.find("button").off("click"),f.call("documents")},e.prototype.bind=function(){return this.element.find("button").on("click",(t=this,function(e){var n,r,o;switch((o=$(e.currentTarget)).attr("data-action")){case"edit":return Controllers.DocumentController.edit(o.attr("data-id"));case"export":return(n=new jsPDF).fromHTML(t.element.find("article").html(),20,20,{width:210,height:297,elementHandlers:{}}),(r=document.createElement("a")).download=t.element.find("h1").text()+".pdf",r.href=n.output("datauristring"),r.click();case"delete":if(confirm("Are you sure?"))return Controllers.DocumentController.delete(o.attr("data-id"));break;case"close":return t.close()}}));var t},e}(Views.BaseView),Views.DocumentItemView=l,a=function(t){function e(){e.__super__.constructor.call(this,$("#canvas"),(function(t){var e,n,r;for(e in r="<h1 class='category-title'></h1>",r+="<ul class='documents'>",t)r+="<li data-id='"+(n=t[e]).id+"'> <img src='assets/document.png' /> <div class='title'>"+n.title+"</div> </li>";return r+"</ul><div class='clear'></div>"}))}return h(e,t),e.prototype.render=function(t,n){return null==n&&(n=!1),e.__super__.render.call(this,t),n&&$(".category-title").text(n),this.bind()},e.prototype.bind=function(){return this.element.find("li").on("click",(function(t){var e;return e=$(t.currentTarget).attr("data-id"),d.trigger("document:show",e)}))},e}(Views.BaseView),Views.DocumentListView=a}).call(this);